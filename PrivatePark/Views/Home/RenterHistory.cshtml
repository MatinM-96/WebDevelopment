@model IEnumerable<Parkering>
@using Microsoft.AspNetCore.Identity
@using Microsoft.EntityFrameworkCore
@using mnacr22.Data
@inject UserManager<ApplicationUser> _userManager
@inject ApplicationDbContext _db
@{
    var applicationUser = await _userManager.GetUserAsync(User);
}

@{
    ViewBag.Title = "History";
    Layout = "_Layout";
}

<h1><strong>Parkingspot history</strong></h1>
<h2><strong>Your rented parkingspots</strong></h2>

@{
    IEnumerable<Parkering> test = _db.Parkerings.Where(x => x.Renter == applicationUser)
        .Include(c => c.Address).Include(d => d.Rentee)
        .Include(e => e.Car);

    foreach (var park in test)
    {
        <p></p>
        <div>Street: @park.Address.Street</div>
        <div>City: @park.Address.City</div>
        <div>Zip: @park.Address.ZiptCode</div>
        <div>Start time: @park.StartTime</div>
        <div>End time: @park.EndTime</div>
        <div>Vehicle: @park.Car.RegistrationNumber</div>
        <div>Payment recieved: @park.PricePaid NOK</div>
        <div>Name of rentee: @park.Renter.Firstname @park.Renter.Lastname</div>
        
        if (park.Renter != park.Rentee)
        {
            @using (Html.BeginForm("Index", "Chat", FormMethod.Post))
            {
                <div class="row">
                    <div class="col-md-6">
                        <div class="form-floating">
                            <input id="username" name="username" type="text" value="@park.Renter.Email" class="form-control" hidden/>
                            <span class="text-danger"></span>
                        </div>
                        <button id="update-profile-button" type="submit" class="w-100 btn btn-lg btn-primary">Send a message to the rentee</button>
                    </div>
                </div> 
            }
        }
        <p></p>
    }
}